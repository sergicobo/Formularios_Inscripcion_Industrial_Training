<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ficha Inscripción - Industrial Training</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #000000;
            --muted: #6b7280;
            --accent: #f3ae00;
            --industrial: #E1AA00;
            --black: #000000;
            --white: #ffffff;
            --shadow: 0 6px 18px rgba(0,0,0,0.08);
            --error: #dc2626;
            --success: #059669;
        }

        body {
            font-family: 'Poppins', 'Open Sans', Arial, sans-serif;
            background: var(--black);
            margin: 0;
            padding: 24px;
            color: var(--text);
        }

        .wrap {
            max-width: 820px;
            margin: 24px auto;
        }

        .card {
            background: var(--industrial);
            border-radius: 12px;
            padding: 22px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.04);
        }

        .header {
            width: 100%;
            text-align: center;
            background: black;
            border-bottom: 4px solid var(--accent);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            padding: 0;
            border-radius: 12px;
            overflow: hidden;
        }

            .header .logo {
                width: 100%;
                max-height: 180px;
                object-fit: contain;
                display: block;
                margin: 0 auto;
            }

            .header h1 {
                margin: 0;
                font-size: 1.8rem;
                color: var(--industrial);
            }

            .header .lead {
                font-size: 1rem;
                color: #555;
                margin-top: 0.5rem;
            }

        .logo {
            max-height: 72px;
            object-fit: contain;
        }

        h1 {
            font-size: 20px;
            margin: 0;
            color: var(--black);
        }

        p.lead {
            margin: 6px 0 12px 0;
            color: var(--muted);
        }

        #Inscripcion {
            text-align: center;
            margin-top: 12px;
        }

            #Inscripcion h1 {
                font-size: 1.8rem;
                color: var(--black);
            }

            #Inscripcion .lead {
                font-size: 1rem;
                color: #555;
                margin-top: 0.5rem;
            }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text);
            font-size: 14px;
        }

        input[type="text"], input[type="email"], input[type="tel"], input[type="date"], select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            background: #fff;
            box-sizing: border-box;
            font-size: 14px;
        }

        .full {
            grid-column: 1 / -1;
        }

        .muted-small {
            font-size: 12px;
            color: var(--muted);
            margin-top: 6px;
        }

        .radio-group, .checkbox-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

            .radio-group label, .checkbox-group label {
                font-weight: 400;
                color: var(--text);
            }

        .firma-box {
            text-align: center;
            margin-top: 12px;
        }

        canvas {
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: #fff;
            touch-action: none;
        }

        .btn {
            background: green;
            color: var(--white);
            border: none;
            padding: 12px 18px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s ease;
        }

            .btn:hover {
                opacity: 0.9;
                transform: translateY(-1px);
            }

            .btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none;
            }

            .btn.secondary {
                background: #111827;
                color: var(--white);
            }

        /* Loader mejorado */
        #loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

            #loader .spinner {
                border: 6px solid #333;
                border-top: 6px solid var(--industrial);
                border-radius: 50%;
                width: 60px;
                height: 60px;
                animation: spin 1s linear infinite;
                margin-bottom: 20px;
            }

            #loader .loader-text {
                color: var(--white);
                font-size: 1.1rem;
                font-weight: 600;
                text-align: center;
            }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mensajes de confirmación y error personalizados */
        .message-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .message-box {
            background: var(--white);
            border-radius: 12px;
            padding: 40px;
            max-width: 500px;
            margin: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: messageSlideIn 0.3s ease-out;
        }

        @keyframes messageSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .message-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .message-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--black);
        }

        .message-text {
            font-size: 1rem;
            color: var(--muted);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .message-success .message-icon {
            color: var(--success);
        }

        .message-error .message-icon {
            color: var(--error);
        }

        .message-btn {
            background: var(--industrial);
            color: var(--black);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

            .message-btn:hover {
                background: #c99700;
                transform: translateY(-1px);
            }

        footer.legal {
            margin-top: 18px;
            font-size: 12px;
            color: var(--muted);
        }

        @media (max-width:720px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
            }

            .logo {
                max-height: 64px;
            }

            .message-box {
                margin: 10px;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="card">
            <div class="header">
                <img src="https://raw.githubusercontent.com/sergicobo/Formularios_Inscripcion_Industrial_Training/main/LOGO_INDUSTRIAL.png" alt="Industrial Training" class="logo">
            </div>
            <div id="Inscripcion">
                <h1>Ficha de Inscripción - Industrial Training</h1>
                <p class="lead">Rellene todos los campos del formulario.</p>
            </div>

            <form id="formulario">
                <div class="grid">
                    <div>
                        <label>Nombre</label>
                        <input name="nombre" type="text" required>
                    </div>
                    <div>
                        <label>Apellidos</label>
                        <input name="apellidos" type="text" required>
                    </div>

                    <div class="full">
                        <label>DNI</label>
                        <input name="dni" type="text" required>
                    </div>

                    <div>
                        <label>Fecha de nacimiento</label>
                        <input name="fecha_nacimiento" type="date" required>
                    </div>
                    <div>
                        <label>Teléfono</label>
                        <input name="telefono" type="tel" required>
                    </div>

                    <div class="full">
                        <label>Dirección</label>
                        <input name="direccion" type="text" required>
                    </div>
                    <div class="full">
                        <label>Calle 2 (opcional)</label>
                        <input name="direccion2" type="text">
                    </div>

                    <div>
                        <label>Ciudad</label>
                        <input name="ciudad" type="text" required>
                    </div>
                    <div>
                        <label>Estado / Provincia</label>
                        <input name="estado" type="text" required>
                    </div>

                    <div>
                        <label>Código Postal</label>
                        <input name="cp" type="text" required>
                    </div>
                    <div>
                        <label>Email</label>
                        <input name="email" type="email" required>
                    </div>

                    <div class="full">
                        <label>Cuota</label>
                        <select name="cuota" required>
                            <option value="">Selecciona...</option>
                            <option>Bronce (55€/mes x 2 wods a la semana)</option>
                            <option>Plata (65€/mes x 3 wods a la semana)</option>
                            <option>Oro (75€/mes x 3 wods a la semana)</option>
                            <option>Diamante (85€/mes x clases ilimitadas)</option>
                            <option>Boxeo (65€/mes x clases ilimitadas)</option>
                            <option>Fusión (75€/mes x 2 wods y boxeo ilimitado)</option>
                            <option>KIDS (45€/mes x 1 Actividad)</option>
                            <option>KIDS DUO (65€/mes x 2 actividades)</option>
                        </select>
                    </div>

                    <div class="full">
                        <label>Autorización de derechos de imagen</label>
                        <div class="radio-group">
                            <label><input type="radio" name="imagen" value="Si autorizo" required> Si autorizo a Industrial Training a captar y utilizar mi imagen (fotografías o vídeos) tomadas durante actividades o eventos del gimnasio, con fines informativos y/o promocionales en medios físicos o digitales del centro.</label>
                        </div>
                        <div class="radio-group">
                            <label><input type="radio" name="imagen" value="No autorizo" required> No autorizo mis derechos de imagen</label>
                        </div>
                    </div>

                    <div class="full">
                        <label>Opciones de pago</label>
                        <div class="radio-group">
                            <label><input type="radio" name="pago" value="Domiciliación día 28" required> Domiciliación día 28</label>
                        </div>
                        <div class="radio-group">
                            <label><input type="radio" name="pago" value="Domiciliación día 5" required> Domiciliación día 5</label>
                        </div>
                        <div class="radio-group">
                            <label><input type="radio" name="pago" value="Efectivo" required> Efectivo (Máximo hasta el día 5 de cada mes)</label>
                        </div>
                        <p class="muted-small">
                            En caso de devolución del recibo, se cobrarán 8 € por costes bancarios. Si no se realiza el pago antes del día 5, el recibo se girará automáticamente. Si la deuda no se paga antes del día 8, la membresía se dará de baja y deberá reiniciarse la inscripción con los pagos correspondientes. La solicitud de baja deberá realizarse antes del día 25 de cada mes.
                        </p>
                    </div>

                    <div class="full">
                        <label>Número de cuenta IBAN</label>
                        <input name="iban" type="text">
                        <p class="muted-small">
                            Autorizo a Industrial Training a gestionar los pagos de mis cuotas mediante domiciliación bancaria conforme a la normativa SEPA (Reglamento UE 260/2012). Declaro que los datos bancarios proporcionados son veraces y autorizo su uso exclusivo para este fin.
                        </p>
                    </div>

                    <div class="full">
                        <label>Fecha actual</label>
                        <input name="fecha_actual" id="fecha_actual" readonly>
                    </div>

                    <div class="full">
                        <label>Firma del cliente</label>
                        <div class="firma-box">
                            <canvas id="firma" width="560" height="180"></canvas><br>
                            <button type="button" id="borrar" class="btn secondary" style="margin-top:8px;">Borrar firma</button>
                        </div>
                        <div class="radio-group">
                            <label><input type="radio" name="conditions" value="Condiciones" required> Declaro haber leído y aceptado las condiciones anteriores, así como las normas internas de Industrial Training.</label>
                        </div>
                    </div>

                </div>

                <div style="margin-top:16px; text-align:right;">
                    <button type="submit" class="btn" id="submitBtn">Enviar inscripción</button>
                </div>

                <footer class="legal">
                    <p class="muted-small">
                        <strong>Protección de datos:</strong> De acuerdo con el Reglamento (UE) 2016/679 (RGPD) y la Ley Orgánica 3/2018 (LOPDGDD), se informa que el responsable del tratamiento de la información es Industrial Training, con la finalidad de gestionar inscripciones, cobros y actividades del gimnasio.
                    </p>
                </footer>
            </form>
        </div>
    </div>

    <!-- Loader mejorado -->
    <div id="loader">
        <div class="spinner"></div>
        <div class="loader-text">Procesando su inscripción...<br>Por favor, espere.</div>
    </div>

    <!-- Mensaje de éxito -->
    <div id="successMessage" class="message-container">
        <div class="message-box message-success">
            <div class="message-icon">✅</div>
            <div class="message-title">¡Inscripción Enviada Correctamente!</div>
            <div class="message-text">
                Gracias por registrarse en <strong>Industrial Training</strong>.<br>
                Su ficha de inscripción ha sido procesada exitosamente.<br>
                Nos pondremos en contacto con usted muy pronto.
            </div>
            <button class="message-btn" onclick="closeMessage('successMessage')">Entendido</button>
        </div>
    </div>

    <!-- Mensaje de error -->
    <div id="errorMessage" class="message-container">
        <div class="message-box message-error">
            <div class="message-icon">❌</div>
            <div class="message-title">Error al Enviar la Inscripción</div>
            <div class="message-text" id="errorText">
                Ha ocurrido un problema al procesar su inscripción.<br>
                Por favor, revise los datos e inténtelo nuevamente.
            </div>
            <button class="message-btn" onclick="closeMessage('errorMessage')">Intentar de Nuevo</button>
        </div>
    </div>

    <script>
        // Establecer fecha actual
        document.getElementById('fecha_actual').value = new Date().toLocaleDateString('es-ES');

        // Funciones para manejar mensajes
        function showMessage(messageId) {
            document.getElementById(messageId).style.display = 'flex';
        }

        function closeMessage(messageId) {
            document.getElementById(messageId).style.display = 'none';
            if (messageId === 'successMessage') {
                // Resetear formulario después de éxito
                document.getElementById('formulario').reset();
                // Limpiar firma
                const canvas = document.getElementById('firma');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                // Restaurar fecha
                document.getElementById('fecha_actual').value = new Date().toLocaleDateString('es-ES');
            }
        }

        // Funcionalidad de firma
        (function () {
            const canvas = document.getElementById('firma');
            const ctx = canvas.getContext('2d');
            let drawing = false;
            let lastX = 0, lastY = 0;

            function start(e) {
                drawing = true;
                [lastX, lastY] = getXY(e);
                ctx.beginPath();
            }
            function end(e) {
                drawing = false;
                ctx.beginPath();
            }
            function draw(e) {
                if (!drawing) return;
                const [x, y] = getXY(e);
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#111';
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();
                [lastX, lastY] = [x, y];
            }
            function getXY(e) {
                const rect = canvas.getBoundingClientRect();
                if (e.touches && e.touches.length) {
                    return [e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top];
                } else {
                    return [e.clientX - rect.left, e.clientY - rect.top];
                }
            }

            canvas.addEventListener('mousedown', start);
            canvas.addEventListener('touchstart', start);
            window.addEventListener('mouseup', end);
            canvas.addEventListener('touchend', end);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('touchmove', function (e) { e.preventDefault(); draw(e); }, { passive: false });

            document.getElementById('borrar').addEventListener('click', function () { 
                ctx.clearRect(0, 0, canvas.width, canvas.height); 
            });

            // Manejo del envío del formulario
            const form = document.getElementById('formulario');
            const loader = document.getElementById('loader');
            const submitBtn = document.getElementById('submitBtn');

            form.addEventListener('submit', function (e) {
                e.preventDefault();
                
                // Mostrar loader y deshabilitar botón
                loader.style.display = 'flex';
                submitBtn.disabled = true;
                submitBtn.textContent = 'Enviando...';
                
                const dataUrl = canvas.toDataURL('image/png');
                const data = new FormData(form);
                data.append('firma', dataUrl);
                
                // Generar HTML del formulario con datos completos para el PDF
                const formDataForPdf = generateFormularioHTML(data);
                data.append('formulario_html', formDataForPdf);

                const scriptURL = 'https://script.google.com/macros/s/AKfycbx8BWMBA-X5rQERw-GxxISXfYYPzdbamSBWGQmHjanwUZkGYCcj6znYNkGSqSbZeOUCVg/exec';

                fetch(scriptURL, { method: 'POST', body: data })
                    .then(r => r.text())
                    .then(txt => {
                        // Ocultar loader y restaurar botón
                        loader.style.display = 'none';
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Enviar inscripción';
                        
                        if (txt && txt.startsWith('OK')) {
                            showMessage('successMessage');
                        } else {
                            // Mostrar error con detalles
                            document.getElementById('errorText').innerHTML = 
                                'Ha ocurrido un problema al procesar su inscripción.<br>' +
                                '<strong>Detalles del error:</strong><br>' + 
                                (txt || 'Error desconocido') + '<br><br>' +
                                'Por favor, revise los datos e inténtelo nuevamente.';
                            showMessage('errorMessage');
                        }
                    })
                    .catch(err => {
                        // Ocultar loader y restaurar botón
                        loader.style.display = 'none';
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Enviar inscripción';
                        
                        // Mostrar error de conexión
                        document.getElementById('errorText').innerHTML = 
                            'Error de conexión al enviar el formulario.<br>' +
                            '<strong>Detalles:</strong><br>' + err.message + '<br><br>' +
                            'Por favor, verifique su conexión a internet e inténtelo nuevamente.';
                        showMessage('errorMessage');
                    });
            });

            // Función para generar HTML del formulario con los datos del usuario
            function generateFormularioHTML(formData) {
                const data = {};
                for (let [key, value] of formData) {
                    if (key !== 'firma' && key !== 'formulario_html') {
                        data[key] = value;
                    }
                }

                return `<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Ficha de Inscripción - Industrial Training</title>
    <style>
        body { 
            font-family: 'Poppins', Arial, sans-serif; 
            max-width: 800px; 
            margin: 20px auto; 
            padding: 20px; 
            background: #E1AA00;
            color: #000;
        }
        .header { 
            text-align: center; 
            background: black; 
            color: #E1AA00; 
            padding: 20px; 
            border-radius: 12px; 
            margin-bottom: 20px;
        }
        .title { 
            font-size: 1.8rem; 
            font-weight: 700; 
            margin: 10px 0;
        }
        .subtitle { 
            font-size: 1rem; 
            margin-bottom: 10px;
        }
        .grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            margin: 20px 0;
        }
        .full { 
            grid-column: 1 / -1; 
        }
        .campo { 
            background: white; 
            padding: 12px; 
            border-radius: 8px; 
            border: 1px solid #ddd;
        }
        .label { 
            font-weight: 600; 
            color: #333; 
            margin-bottom: 5px;
            font-size: 14px;
        }
        .value { 
            color: #000; 
            font-size: 14px;
            min-height: 20px;
        }
        .firma-section { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            text-align: center; 
            margin-top: 20px;
        }
        .legal { 
            font-size: 12px; 
            color: #333; 
            margin-top: 20px; 
            padding: 15px; 
            background: rgba(255,255,255,0.9); 
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">Ficha de Inscripción - Industrial Training</div>
        <div class="subtitle">Formulario Completado</div>
    </div>

    <div class="grid">
        <div class="campo">
            <div class="label">Nombre</div>
            <div class="value">${data.nombre || ''}</div>
        </div>
        <div class="campo">
            <div class="label">Apellidos</div>
            <div class="value">${data.apellidos || ''}</div>
        </div>
        <div class="campo full">
            <div class="label">DNI</div>
            <div class="value">${data.dni || ''}</div>
        </div>
        <div class="campo">
            <div class="label">Fecha de nacimiento</div>
            <div class="value">${data.fecha_nacimiento || ''}</div>
        </div>
        <div class="campo">
            <div class="label">Teléfono</div>
            <div class="value">${data.telefono || ''}</div>
        </div>
        <div class="campo full">
            <div class="label">Dirección</div>
            <div class="value">${data.direccion || ''}</div>
        </div>
        ${data.direccion2 ? `<div class="campo full">
            <div class="label">Calle 2</div>
            <div class="value">${data.direccion2}</div>
        </div>` : ''}
        <div class="campo">
            <div class="label">Ciudad</div>
            <div class="value">${data.ciudad || ''}</div>
        </div>
        <div class="campo">
            <div class="label">Estado / Provincia</div>
            <div class="value">${data.estado || ''}</div>
        </div>
        <div class="campo">
            <div class="label">Código Postal</div>
            <div class="value">${data.cp || ''}</div>
        </div>
        <div class="campo">
            <div class="label">Email</div>
            <div class="value">${data.email || ''}</div>
        </div>
        <div class="campo full">
            <div class="label">Cuota</div>
            <div class="value">${data.cuota || ''}</div>
        </div>
        <div class="campo full">
            <div class="label">Autorización de derechos de imagen</div>
            <div class="value">${data.imagen || ''}</div>
        </div>
        <div class="campo full">
            <div class="label">Opciones de pago</div>
            <div class="value">${data.pago || ''}</div>
        </div>
        <div class="campo full">
            <div class="label">Número de cuenta IBAN</div>
            <div class="value">${data.iban || ''}</div>
        </div>
        <div class="campo full">
            <div class="label">Fecha actual</div>
            <div class="value">${data.fecha_actual || ''}</div>
        </div>
        <div class="campo full">
            <div class="label">Condiciones</div>
            <div class="value">${data.conditions || ''}</div>
        </div>
    </div>

    <div class="firma-section">
        <div class="label">Firma del cliente</div>
        <div style="margin-top: 10px; border: 1px solid #ddd; height: 150px; display: flex; align-items: center; justify-content: center; background: #fafafa;">
            [Firma capturada digitalmente]
        </div>
    </div>

    <div class="legal">
        <strong>Información sobre pagos:</strong> En caso de devolución del recibo, se cobrarán 8 € por costes bancarios. Si no se realiza el pago antes del día 5, el recibo se girará automáticamente. Si la deuda no se paga antes del día 8, la membresía se dará de baja y deberá reiniciarse la inscripción con los pagos correspondientes. La solicitud de baja deberá realizarse antes del día 25 de cada mes.<br><br>
        
        <strong>Autorización SEPA:</strong> Autorizo a Industrial Training a gestionar los pagos de mis cuotas mediante domiciliación bancaria conforme a la normativa SEPA (Reglamento UE 260/2012). Declaro que los datos bancarios proporcionados son veraces y autorizo su uso exclusivo para este fin.<br><br>
        
        <strong>Protección de datos:</strong> De acuerdo con el Reglamento (UE) 2016/679 (RGPD) y la Ley Orgánica 3/2018 (LOPDGDD), se informa que el responsable del tratamiento de la información es Industrial Training, con la finalidad de gestionar inscripciones, cobros y actividades del gimnasio.
    </div>
</body>
</html>`;
            }
        })();
    </script>
</body>
</html>